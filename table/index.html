<!doctype html>
<html lang="zh">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>æœˆæ¦œç­‰æ¦œå•(Beta)</title>
	<meta name="darkreader-lock">
	<script>
		if (window.matchMedia('(prefers-color-scheme: dark)').matches)
			document.documentElement.setAttribute('data-bs-theme', 'dark');

		window.matchMedia('(prefers-color-scheme: dark)')
			.addEventListener('change', function () {
				document.documentElement.setAttribute("data-bs-theme",
					window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light")
			});
	</script>
	<link href="https://cdn.staticfile.net/twitter-bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdn.staticfile.net/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
	<link href="https://cdn.staticfile.net/bootstrap-table/1.22.2/bootstrap-table.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/main.css">
</head>

<body>
	<div class="container-fluid">
		<div>
			<div class="input-group mt-3">
				<span class="input-group-text">å¼€å§‹â±ï¸</span>
				<input id="time_start" type="datetime-local" class="form-control" name="time_start">
				<span class="input-group-text">ç»“æŸâ±</span>
				<input id="time_end" type="datetime-local" class="form-control" name="time_end">
			</div>

			<div class="input-group mt-3">
				<span class="input-group-text">ğŸ‘‡è¯´æ˜åœ¨åº•éƒ¨</span>
				<span class="input-group-text">ğŸ‘¤å¯¹å±€æ•°â‰¥</span>
				<input id="log_count" type="number" class="form-control" name="log_count" value="1" onchange="search()">
				<button type="button" class="btn btn-primary" onclick="search(true)">ğŸ”æœç´¢</button>
			</div>
		</div>
		<div class="toolbar input-group">
			<select class="form-select" id="time_type" onchange="search()">
				<option value="1">å¹´æ¦œ</option>
				<option value="2">åŠå¹´æ¦œ</option>
				<option value="3">å­£æ¦œ</option>
				<option value="4">åŒæœˆæ¦œ</option>
				<option value="5" selected>æœˆæ¦œ</option>
				<option value="6">åŠæœˆæ¦œ</option>
				<option value="7">å‘¨æ¦œ</option>
				<option value="8">ä¸‰æ—¥æ¦œ</option>
				<option value="9">ä¸€æ—¥æ¦œ</option>
			</select>
			<select class="form-select" id="cid_type" onchange="search()">
				<option value="1" selected>ç»Ÿè®¡å…¨å›½</option>
				<option value="-1">[æµªé€Ÿå—äº¬åˆè®¡]</option>
				<option value="-2">[æµªé€Ÿåˆè®¡]</option>
				<option value="-3">[å¤šæ¥é›€åº„åˆè®¡]</option>
			</select>
			<select class="form-select" id="filter_type" onchange="search()">
				<option value="1" selected>è·¨é›€åº„ç»Ÿè®¡</option>
				<option value="2">æ’é™¤å…¶ä»–é›€åº„</option>
			</select>
		</div>
		<table id="my_table" class="table-sm table-striped" data-search="true" data-show-columns="true"
			data-pagination="true" data-page-size="15" data-show-export="true" data-toolbar=".toolbar"
			data-buttons="buttons" data-page-list="[15, 25, 50, 100, 150, All]">
			<thead>
				<tr>
					<th data-field="0" data-sortable="true">#</th>
					<th data-field="1" data-sortable="true">é€‰æ‰‹</th>
					<th data-field="2" data-sortable="true">å½’å±</th>
					<th data-field="3" data-sortable="true">15è¿</th>
					<th data-field="4" data-sortable="true">æ€»æˆç»©</th>
					<th data-field="5" data-sortable="true">å‡é¡º</th>
					<th data-field="6" data-sortable="true">å‡ç‚¹</th>
					<th data-field="7" data-sortable="true">å±€æ•°</th>
					<th data-field="8" data-sortable="true">1</th>
					<th data-field="9" data-sortable="true">2</th>
					<th data-field="10" data-sortable="true">3</th>
					<th data-field="11" data-sortable="true">4</th>
				</tr>
			</thead>
			<tbody id="table_body"></tbody>
		</table>
		<div class="mt-3 alert alert-warning alert-dismissible fade show" role="alert">
			<kbd>æˆç»©</kbd> = (æœ€ç»ˆç‚¹æ•°-25000)Ã·1000+<kbd>é©¬</kbd>(1ä½~4ä½çš„é©¬ä¾æ¬¡æ˜¯ +30 +10 -10 -30)<br />
			<kbd>15è¿</kbd> = è¿ç»­15å±€æœ€é«˜<kbd>æˆç»©</kbd><br />
			<kbd>å‡é¡º</kbd> = å¹³å‡é¡ºä½<br />
			<kbd>å‡ç‚¹</kbd> = å¹³å‡ç‚¹æ•°<br />
			<kbd>æ—¶é—´é€‰æ‹©å™¨</kbd>æ˜¯<kbd>æ ‡å‡†æ—¶</kbd> æˆ‘ä»¬æ˜¯UTC+8ï¼Œæ—¶é—´é€‰æ‹©å™¨ä¼šå°‘8ä¸ªå°æ—¶<br />
			<kbd>å­£æ¦œ</kbd> æ˜¯ 1~3æœˆ / 4~6æœˆ / 7~9æœˆ / 10~12æœˆ<br />
			<kbd>åŠå¹´æ¦œ</kbd> æ˜¯ 1~6æœˆ / 7~12æœˆ<br />
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	</div>
	<script src="https://cdn.staticfile.net/jquery/3.7.1/jquery.min.js"></script>

	<script src="https://cdn.staticfile.net/twitter-bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.staticfile.net/bootstrap-table/1.22.2/bootstrap-table.min.js"></script>
	<script crossorigin="anonymous"
		src="https://cdn.staticfile.net/bootstrap-table/1.22.2/bootstrap-table-locale-all.min.js"></script>
	<script src="../js/data_list.js"></script>
	<script
		src="https://cdn.staticfile.net/bootstrap-table/1.22.2/extensions/export/bootstrap-table-export.min.js"></script>
	<script src="https://unpkg.com/tableexport.jquery.plugin@1.28.0/tableExport.min.js"></script>
	<script>
		var select = document.getElementById('cid_type');
		var cid;
		for (cid in cid2name) {
			if (Object.hasOwnProperty.call(cid2name, cid)) {
				// <option value="2">æµªé€ŸÂ·å—äº¬</option>
				var opt = document.createElement('option');
				opt.setAttribute('value', cid);
				opt.appendChild(document.createTextNode(cid2name[cid]));
				select.appendChild(opt);
			}
		}
		function search(skip_set_time = false) {
			if (!skip_set_time) {
				gen_start_end();
			}
			var filter = document.getElementById('filter_type').value;
			var cid = document.getElementById('cid_type').value;
			var start = document.getElementById('time_start').valueAsNumber / 1000;
			var end = document.getElementById('time_end').valueAsNumber / 1000;
			console.log(start, end)
			fetch(`https://cdn.r-mj.com/r/table.php?cid=${cid}&start=${start}&end=${end}&filter=${filter}`)
				.then((response) => response.json())
				.then((myjson) => {
					var data = [];
					var table = $('#my_table');
					console.log(myjson);
					var arr = myjson.data;
					var i = 0;
					var count = parseInt(document.getElementById('log_count').value);
					var is_count = count > 1;
					arr.forEach(e => {
						e[1] = cid2name[e[1]];
						e[2] /= 10;//$row['max15'],
						e[3] /= 10;//$row['total_score'],
						e[4] = (e[4] / e[6]).toFixed(2);//$row['total_order'],
						e[5] = Math.round(e[5] * 100 / e[6]);//$row['total_order'],
						if (is_count) {//è¦è¿‡æ»¤
							if (e[6] >= count) {
								data[i] = e;
								i++;
							}
						} else {//ä¸è¦è¿‡æ»¤
							data[i] = e;
							i++;
						}
						e.unshift(i);
					});
					//$('#my_table').bootstrapTable({ data: data });

					if (cid === '1') {
						table.bootstrapTable('showColumn', '2');
					} else {
						table.bootstrapTable('hideColumn', '2');
					}
					table.bootstrapTable('load', data);
				});

		}

		function gen_start_end() {
			var type = document.getElementById('time_type').value;
			var start = document.getElementById('time_start');
			var end = document.getElementById('time_end');
			var d = new Date();
			var m = d.getMonth() + 1;
			var y = d.getFullYear();
			var date = d.getDate();
			var xday = d.getDay();
			var start0, end0;
			var today0 = new Date(y, m - 1, date, 0, 0, 0);
			var today9 = new Date(y, m - 1, date, 23, 59, 59);
			switch (type) {
				case '1'://å¹´æ¦œ
					start0 = new Date(y, 0, 1, 0, 0, 0);
					end0 = new Date(y, 11, 31, 23, 59, 59);
					break;
				case '2'://åŠå¹´æ¦œ 1ï½6æœˆï¼Œ7ï½12æœˆ
					if (m >= 7) {
						start0 = new Date(y, 6, 1, 0, 0, 0);
						end0 = new Date(y, 11, 31, 23, 59, 59);
					} else {
						start0 = new Date(y, 0, 1, 0, 0, 0);
						end0 = new Date(y, 6, 30, 23, 59, 59);
					}
					break;
				case '3'://å­£æ¦œ 1ï½3ï¼Œ4ï½6ï¼Œ7ï½9ï¼Œ10ï½12
					if (m >= 10) { //10~12æœˆ
						start0 = new Date(y, 9, 1, 0, 0, 0);
						end0 = new Date(y, 11, 31, 23, 59, 59);
						break;
					}
					if (m <= 3) { //1~3æœˆ
						start0 = new Date(y, 0, 1, 0, 0, 0);
						end0 = new Date(y, 2, 31, 23, 59, 59);
						break;
					}
					if (m <= 6) { //4ï½6æœˆ
						start0 = new Date(y, 3, 1, 0, 0, 0);
						end0 = new Date(y, 5, 30, 23, 59, 59);
					} else { //7ï½9æœˆ
						start0 = new Date(y, 6, 1, 0, 0, 0);
						end0 = new Date(y, 8, 30, 23, 59, 59);
					}
					break;
				case '4': //åŒæœˆæ¦œ
					if (m % 2 === 0) { //endä¸å˜
						start0 = new Date(y, m - 2, 1, 0, 0, 0);
						if (m == 12) {
							end0 = new Date(y, 11, 31, 23, 59, 59);
						} else {
							end0 = new Date(y, m, 1, 0, 0, 0);
						}
					} else { //startä¸å˜
						start0 = new Date(y, m - 1, 1, 0, 0, 0);
						if (m == 11) {
							end0 = new Date(y, 11, 31, 23, 59, 59);
						} else {
							end0 = new Date(y, m + 1, 1, 0, 0, 0);
						}
					}
					break;
				case '6'://åŠæœˆæ¦œ
					if (date <= 15) {
						start0 = new Date(y, m - 1, 1, 0, 0, 0);
						end0 = new Date(y, m - 1, 15, 23, 59, 59);
					} else {
						start0 = new Date(y, m - 1, 16, 0, 0, 0);
						end0 = new Date(y, m, 1, 0, 0, 0);
					}
					break;
				case '7'://å‘¨æ¦œ
					offset = [-6, 0, -1, -2, -3, -4, -5];
					start0 = new Date(today0.getTime() + 86400000 * offset[xday]);
					end0 = today9;
					break;
				case '8'://ä¸‰æ—¥æ¦œ
					start0 = new Date(today0.getTime() + 86400000 * -2);
					end0 = today9;
					break;
				case '9'://1æ—¥æ¦œ
					start0 = today0;
					end0 = today9;
					break;
				default:
					start0 = new Date(y, m - 1, 1, 0, 0, 0);
					end0 = new Date(y, m, 1, 0, 0, 0);
					break;
			}
			start.valueAsNumber = start0.getTime();
			end.valueAsNumber = end0.getTime();
		}
		$(function () {
			var data = [
				[1, "\u84ec\u5c0f\u84bf", "2", 5563, 7891, 229, 69, 115, 36, 32, 25, 22],
				[2, "XinQ", "21", 5321, 10969, 180, 249, 44, 20, 15, 7, 2],
				[3, "\u6728\u6728", "2", 5144, 11517, 215, 115, 100, 37, 24, 26, 13],
				[4, "DDMM", "47", 4817, 14295, 212, 123, 116, 41, 35, 25, 15],
			];
			$('#my_table').bootstrapTable({ data: data, locale: 'zh-CN' })
			if (window.location.hash.length >= 3) {
				var cid = window.location.hash.replace(/[^\d]/g, '');
				if (cid >= 2) {
					$("#cid_type").val(cid);
				}
			}
			search();
		})
	</script>
</body>

</html>