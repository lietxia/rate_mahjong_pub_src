<!doctype html>
<html lang="zh">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
		crossorigin="anonymous">

	<title>个人战绩</title>
	<style>
		#chart_rader {
			height: 200px;
		}

		#chart_line {
			height: 120px;
		}

		#qqHead {
			width: 180px;
		}
	</style>
</head>

<body class="mt-3 bg-secondary">
	<div class="container">
		<div class="card shadow-lg">
			<div class="row">
				<div class="col-3 text-end" id="head_input">
				</div>
				<div class="col-md-4 d-flex align-items-center">
					<div class="ps-4">
						<h5 class="card-title mb-0">
							<span class="badge bg-primary" id="level"></span>
							<span class="json_text" id="userName"></span>
						</h5>

						<span class="badge bg-secondary rounded-pill">R<span class="json_text" id="rate"></span></span>
						<span class="json_text badge bg-secondary rounded-pill" id="club"></span>
						<span id="title"></span>
						<br>
						全国排行：<span class="json_text" id="rank"></span><br>
						<span class="json_text" id="areaName"></span>：<span class="json_text" id="areaRank"></span><br>
						总对局数：<span class="json_text" id="totalCount"></span><br>
						飞人吃一：<span class="json_text" id="killCount"></span>
					</div>
				</div>
				<div class="col-md-5 d-flex align-items-center">
					<div class="ps-4">
						<h5 class="card-title mb-0">升段条件</h5>
						<span class="badge bg-secondary rounded-pill mb-1" id="levelUp"></span><br>
						升段均顺：<span class="json_text" id="currentAvg"></span><br>
						升段对局：<span class="json_text" id="currentCount"></span><br>
						最高得点：<span class="json_text" id="maxPoint"></span><br>
						通算得点：<span class="json_text" id="totalScore"></span><br>
						平均得点：<span class="json_text" id="pointAvg"></span>
					</div>
				</div>
			</div>

			<div id="chart_rader"></div>
			<div id="chart_line"></div>
			<div class="card-footer text-muted text-center">
				https://rate.000.mk 全国雀庄公式战 <span id="now">2021-12-28 12:12</span>
			</div>
		</div>
	</div>


	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/echarts@5.2.2/dist/echarts.min.js"></script>
	<script>
		var today = new Date();
		var y = today.getFullYear();
		var m = today.getMonth() + 1;
		var d = today.getDate();
		var h = today.getHours();
		var minutes = today.getMinutes();
		m = m < 10 ? '0' + m : m;
		d = d < 10 ? '0' + d : d;
		h = h < 10 ? '0' + h : h;
		minutes = minutes < 10 ? '0' + minutes : minutes;
		document.getElementById("now").innerText = y + "-" + m + "-" + d + ' ' + h + ":" + minutes;

		var apiurl = "https://000.mk/r/chart.php";
		function image_loaded() {
			var span = document.createElement('span');
			span.id = 'image_loaded';
			document.body.append(span);
		}
		fetch(apiurl + window.location.search)
			.catch(error => alert("fetch失败"))
			.then((response) => response.json())
			.then((json) => {
				if (json.code == 0 && json.hasOwnProperty("msg")) {//成功
					if (json.msg === '需要参数') {
						var userName = prompt('请输入选手昵称');
						return window.location.search = "name=" + userName;
					}
					return alert(json.msg);
				}
				if (json.code == 1) {//成功
					return generateCharts(json)
				}
				if (json.code == 2) {//多重
					var number = prompt(json.msg, 1);
					if (number > 0) {
						return window.location.search += "&area=" + number;
					} else {
						return alert('错误的输入')
					}
				}
				return alert("找不到此选手");
			});

		function generateCharts(jsonData) {

			var levelConfig = [
				['新人', '近7战 均顺≤2.9'],
				['五级', '近7战 均顺≤2.8'],
				['四级', '近10战 均顺≤2.7'],
				['三级', '近10战 均顺≤2.7'],
				['二级', '近12战 均顺≤2.6'],
				['一级', '近16战 均顺≤2.6'],
				['初段', '近16战 均顺≤2.5'],
				['二段', '近20战 均顺≤2.5'],
				['三段', '近25战 均顺≤2.4'],
				['四段', '近25战 均顺≤2.3'],
				['五段', '近30战 均顺≤2.3'],
				['六段', '近40战 均顺≤2.2'],
				['七段', '近40战 均顺≤2.2'],
				['八段', '近50战 均顺≤2.1'],
				['九段', '已登顶'],
			];
			if (jsonData.radar[0] == 0) { //火力怪异现象
				jsonData.radar[0] = null;
			}
			var img = document.createElement('img');
			img.id = 'qqHead';
			img.setAttribute('src', "https://q1.qlogo.cn/g?b=qq&s=640&nk=" + jsonData.qq);
			img.setAttribute('class', "img-thumbnail rounded-circle m-3 shadow-sm");
			img.setAttribute('onload', 'image_loaded()');
			document.getElementById('head_input').appendChild(img);

			document.getElementById('level').innerText = levelConfig[jsonData.level][0];
			document.getElementById('levelUp').innerText = levelConfig[jsonData.level][1];
			var myClass = document.getElementsByClassName("json_text");
			for (let i = 0; i < myClass.length; i++) {
				const element = myClass[i];
				element.innerText = jsonData[element.id];
			}
			var myChart = echarts.init(document.getElementById("chart_rader"));
			var myChart2 = echarts.init(document.getElementById("chart_line"));
			var app = {};
			var option = {
				legend: { show: false },
				tooltip: { show: true, },
				radar: {
					// shape: 'circle',
					indicator: [
						{ name: '火力 (一位时平均点数)', max: 47000, min: 35000 },
						{ name: '防守 (不飞率)', max: 0.95, min: 0.6 },
						{ name: '稳定 (连对率)', max: 0.6 },
						{ name: '运势 (近十战平均顺位)', max: 2.8 },
						{ name: '技术 (Rate)', max: 1800, min: 1300 },
						{ name: '进攻 (一位率)', max: 0.35 }
					],
					center: ['25%', '50%'],
					radius: "65%",
					axisName: {
						color: '#333',
						fontWeight: 'bold',
					},
				},
				series: [
					{
						type: 'radar',
						symbolSize: 6,
						data: [
							{
								value: jsonData.radar,
								areaStyle: {
									color: 'rgba(30, 200, 255, 0.6)'
								}
							}
						]
					},
					{
						center: ['70%', '50%'],
						type: 'pie',
						radius: ['40%', '75%'],
						itemStyle: {
							borderRadius: 5,
							borderColor: '#fff',
							borderWidth: 2
						},
						label: {
							show: true,
							formatter: '{d}%\n{c}回 {b}'
						},
						labelLine: {
							length: 10,
							length2: 15,
						},
						data: jsonData.pie
					},

				]
			};
			var option2 = {
				legend: {
					show: false
				},
				tooltip: { show: true, },
				grid: {
					left: '7%',
					right: '7%',
					top: '5%',
					bottom: 0,
					containLabel: true
				},
				xAxis: {
					type: 'category',
					show: false,
					boundaryGap: false,
				},
				yAxis: {
					type: 'value'
				},
				series: [
					{
						data: jsonData.recent,
						type: 'line',
						symbol: 'circle',
						symbolSize: 5,
						smooth: true,
						areaStyle: {
							opacity: 0.7,
							color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
								{
									offset: 0,
									color: 'rgb(128, 255, 165)'
								},
								{
									offset: 1,
									color: 'rgb(1, 191, 236)'
								}
							])
						},
					}
				]
			};

			if (option && typeof option === 'object') {
				myChart.setOption(option);
				myChart2.setOption(option2);
			}
		}

	</script>

</body>

</html>